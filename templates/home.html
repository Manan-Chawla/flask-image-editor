<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>EditImager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    .preview-box {
      border: 2px dashed #ccc;
      border-radius: 12px;
      height: 360px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f8f9fa;
    }

    .preview-box img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 10px;
    }
  </style>
</head>

<body class="bg-light">

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
  <div class="container-fluid px-4">
    <a class="navbar-brand fw-bold" href="/">EditImager</a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navMenu">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link active" href="/">Editor</a></li>
        <li class="nav-item"><a class="nav-link" href="#">How it Works</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Contact</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- MAIN -->
<div class="container-fluid my-4 px-4">
  <div class="row g-4">

    <!-- LEFT PANEL -->
    <div class="col-md-4">
      <div class="card shadow-sm border-0 rounded-4">
        <div class="card-body p-4">

          <h4 class="fw-bold mb-3">Image Editor</h4>

          <form action="/edit" method="post" enctype="multipart/form-data">

            <div class="mb-3">
              <label class="form-label fw-semibold">Upload Image</label>
              <input class="form-control" type="file" name="image"
                     accept="image/*"
                     onchange="triggerPreview()"
                     required>
            </div>

            <div class="mb-4">
              <label class="form-label fw-semibold">Select Operation</label>
              <select class="form-select" name="operation" onchange="triggerPreview()" required>
                <option disabled selected>Select operation</option>
              
                <optgroup label="Basic">
                  <option value="cgray">Grayscale</option>
                  <option value="resize">Resize (800×800)</option>
                  <option value="rotate">Rotate 90°</option>
                </optgroup>
              
                <optgroup label="Enhancement">
                  <option value="blur">Blur</option>
                  <option value="sharpen">Sharpen</option>
                  <option value="contrast">Increase Contrast</option>
                  <option value="brightness">Increase Brightness</option>
                </optgroup>
              
                <optgroup label="Effects">
                  <option value="edge">Edge Detection</option>
                  <option value="sepia">Sepia Tone</option>
                </optgroup>
              </select>
              
            </div>

            <div class="d-grid">
              <button class="btn btn-success btn-lg">
                Process & Download
              </button>
            </div>

          </form>

        </div>
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="col-md-8">
      <div class="card shadow-sm border-0 rounded-4 h-100">
        <div class="card-body p-4">

          <h4 class="fw-bold mb-3">Preview</h4>

          <div class="preview-box">
            <span class="text-muted" id="previewText">
              Upload an image and select an operation
            </span>
            <img id="previewImg" style="display:none;">
          </div>

          <p class="text-muted mt-3">
            This shows the <strong>processed preview</strong>.
            The file will download after you click the button.
          </p>

        </div>
      </div>
    </div>

  </div>
</div>

<!-- SCRIPT -->
<script>
function triggerPreview() {
  const fileInput = document.querySelector("input[name='image']");
  const operationSelect = document.querySelector("select[name='operation']");

  if (!fileInput.files.length || !operationSelect.value) return;

  const formData = new FormData();
  formData.append("image", fileInput.files[0]);
  formData.append("operation", operationSelect.value);

  fetch("/preview", {
    method: "POST",
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    const img = document.getElementById("previewImg");
    const text = document.getElementById("previewText");

    img.src = data.preview_url + "?t=" + new Date().getTime();
    img.style.display = "block";
    text.style.display = "none";
  });
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
